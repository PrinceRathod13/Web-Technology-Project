<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blue Haven University Login</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body, html { height: 100%; font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg,#eef2ff,#fef9c3); }
    .login-container { min-height: auto; display: flex; justify-content: center; align-items: flex-start; padding: 40px 0; }
    .form-control:focus { box-shadow: none; border-color: #007bff; }
    .university-logo { width: 200px; height: auto; margin-bottom: 12px; }
    .logo-wrapper { margin: 0; }
    .login-form { padding: 22px; background-color: #fff; box-shadow: 0 6px 24px rgba(13, 38, 59, 0.08); max-width: 440px; border-radius: 12px; }
    .small-muted { font-size: .85rem; color:#6c757d }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row login-container">
    <div class="row login-container d-flex justify-content-center align-items-center w-100">
      <div class="login-form w-100">

        <div class="text-center logo-wrapper">
          <!-- update path if needed -->
          <img src="../Images/Uni.png" alt="University Logo" class="university-logo">
        </div>

        <form id="loginForm" novalidate>
          <div class="mb-3">
            <label class="form-label">Role</label><br>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="role" id="staff" value="staff">
              <label class="form-check-label" for="staff">Staff</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="role" id="student" value="student" checked>
              <label class="form-check-label" for="student">Student</label>
            </div>
          </div>

          <!-- Student Fields -->
          <div id="studentFields">
            <div class="mb-3">
              <label for="username" class="form-label">Username</label>
              <input type="text" class="form-control" id="username" placeholder="Mobile No. / Email / Enrollment No" autocomplete="username">
            </div>

            <div class="mb-3">
              <label for="studentPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="studentPassword" placeholder="Password" autocomplete="current-password">
            </div>

            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="showStudentPassword">
              <label class="form-check-label" for="showStudentPassword">Show Password</label>
            </div>
          </div>

          <!-- Staff Fields -->
          <div id="staffFields" style="display: none;">
            <div class="mb-3">
              <label for="staffCode" class="form-label">Staff Code</label>
              <input type="text" class="form-control" id="staffCode" placeholder="Staff Code" autocomplete="username">
            </div>

            <div class="mb-3">
              <label for="staffPassword" class="form-label">Password</label>
              <input type="password" class="form-control" id="staffPassword" placeholder="Password" autocomplete="current-password">
            </div>

            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="showStaffPassword">
              <label class="form-check-label" for="showStaffPassword">Show Password</label>
            </div>
          </div>

          <!-- Buttons -->
          <div class="row mb-3">
            <div class="col-6">
              <button type="submit" id="btnSubmit" class="btn btn-success w-100">Login</button>
            </div>
            <div class="col-6">
              <button type="button" id="btnForgot" class="btn btn-danger w-100">Forgot Password</button>
            </div>
          </div>

          <!-- Student Extras -->
          <div id="studentExtras">
            <div class="text-center mb-2">
              <button type="button" class="btn btn-outline-secondary w-100" id="btn_login">
                <img src="https://developers.google.com/identity/images/g-logo.png" width="20" class="me-2">Sign in with Google
              </button>
              <p class="small-muted text-center mt-2">Please use Google Chrome for better experience</p>
            </div>

            <div class="text-center mb-3" id="registerButton">
              <p class="large mb-1" style="font-style: italic; font-family: sans-serif;">Not Registered Yet?</p>
              <a href="Registration.html" class="btn btn-primary btn-large">Register</a>
            </div>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Run when DOM is ready to avoid timing issues
  document.addEventListener('DOMContentLoaded', function () {
    // Elements
    const studentRadio = document.getElementById('student');
    const staffRadio = document.getElementById('staff');
    const studentFields = document.getElementById('studentFields');
    const staffFields = document.getElementById('staffFields');
    const studentExtras = document.getElementById('studentExtras');
    const loginForm = document.getElementById('loginForm');

    // For debugging: show if script loaded
    console.log('Login script loaded');

    // Toggle display depending on selected role
    function toggleFields() {
      if (studentRadio.checked) {
        studentFields.style.display = 'block';
        staffFields.style.display = 'none';
        studentExtras.style.display = 'block';
      } else {
        studentFields.style.display = 'none';
        staffFields.style.display = 'block';
        studentExtras.style.display = 'none';
      }
    }

    // initialize toggle to correct state in case HTML differs
    toggleFields();

    // Attach change listeners
    studentRadio.addEventListener('change', toggleFields);
    staffRadio.addEventListener('change', toggleFields);

    // Password show/hide
    document.getElementById('showStudentPassword').addEventListener('change', function() {
      const el = document.getElementById('studentPassword');
      el.type = this.checked ? 'text' : 'password';
    });
    document.getElementById('showStaffPassword').addEventListener('change', function() {
      const el = document.getElementById('staffPassword');
      el.type = this.checked ? 'text' : 'password';
    });

    // Replace these with your real paths as needed.
    // NOTE: The path is resolved relative to the page location.
    const STUDENT_HOME = "Home.html"; // or "/student/Home.html"
    const STAFF_DASHBOARD = "../../Admin/Code/Dashboard.html"; // example (adjust as required)

    // Submit handler
    loginForm.addEventListener('submit', function (e) {
      e.preventDefault(); // STOP default submit/navigation
      console.log('Form submit intercepted');

      const role = document.querySelector('input[name="role"]:checked').value;
      if (role === 'student') {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('studentPassword').value.trim();

        if (!username || !password) {
          alert('Please enter both username and password for student login.');
          console.warn('Student validation failed: empty fields');
          return;
        }

        // TODO: If using server auth, send fetch() to server here and redirect on success.
        console.log('Student validated (client-side). Redirecting to student home:', STUDENT_HOME);
        window.location.href = STUDENT_HOME;
        return;
      }

      if (role === 'staff') {
        const staffCode = document.getElementById('staffCode').value.trim();
        const password = document.getElementById('staffPassword').value.trim();

        if (!staffCode || !password) {
          alert('Please enter both staff code and password for staff login.');
          console.warn('Staff validation failed: empty fields');
          return;
        }

        // IMPORTANT debug: show the computed path in console before navigation
        console.log('Staff validated (client-side). Redirecting to staff dashboard:', STAFF_DASHBOARD);
        // Use location.assign to replace current page in history (optional)
        window.location.assign(STAFF_DASHBOARD);
        return;
      }

      // fallback
      console.error('Unknown role selected');
    });

    // Optional: attach forgot-password handler to show debug popup
    document.getElementById('btnForgot').addEventListener('click', function () {
      alert('Forgot password flow — implement link / modal for resetting password.');
    });

    // Optional: Google sign-in button
    document.getElementById('btn_login').addEventListener('click', function () {
      alert('Google sign-in button clicked — implement OAuth flow here.');
    });
  }); // DOMContentLoaded end
</script>

</body>
</html>
